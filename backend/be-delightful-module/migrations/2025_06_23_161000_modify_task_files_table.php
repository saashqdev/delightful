<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ use Hyperf\Database\Migrations\Migration; use Hyperf\Database\Schema\Blueprint; use Hyperf\Database\Schema\Schema; return new class extends Migration { /** * Run the migrations. */ public function up(): void { // Modify delightful_super_agent_task_files tablestructure if (Schema::hasTable('delightful_super_agent_task_files')) { Schema::table('delightful_super_agent_task_files', function (Blueprint $table) { // CheckAndDelete menu field if (Schema::hasColumn('delightful_super_agent_task_files', 'menu')) { $table->dropColumn('menu'); } // in topic_id beforeadd project_id field if (! Schema::hasColumn('delightful_super_agent_task_files', 'project_id')) { $table->unsignedBigInteger('project_id')->after('file_id')->comment('project ID'); } // add new index $table->index('project_id', 'idx_project_id'); }); } } /** * Reverse the migrations. */ public function down(): void { // RollbackOperation if (Schema::hasTable('delightful_super_agent_task_files')) { Schema::table('delightful_super_agent_task_files', function (Blueprint $table) { // DeleteAdd new'sindex try { $table->dropIndex('idx_project_id'); } catch (Exception $e) { // indexMay not existin, ignoreError } // Delete project_id field if (Schema::hasColumn('delightful_super_agent_task_files', 'project_id')) { $table->dropColumn('project_id'); } // Recover menu field (If needed'sspeak) if (! Schema::hasColumn('delightful_super_agent_task_files', 'menu')) { $table->string('menu')->Nullable()->comment('menu'); } }); } } }; 
