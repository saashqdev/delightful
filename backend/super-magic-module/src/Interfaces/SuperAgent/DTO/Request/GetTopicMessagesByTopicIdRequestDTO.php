<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Dtyq\SuperMagic\Interfaces\SuperAgent\DTO\Request; use App\ErrorCode\GenericErrorCode; use App\Infrastructure\Core\Exception\ExceptionBuilder; use Exception; use Hyperf\HttpServer\Contract\RequestInterface; class GetTopicMessagesByTopicIdRequestDTO { /** * ValidSort direction.*/ private const VALID_SORT_DIRECTIONS = ['asc', 'desc']; /** * @var int TopicID*/ protected int $topicId = 0; /** * @var int Page number*/ protected int $page = 1; /** * @var int Page size*/ protected int $pageSize = 20; /** * @var string Sort direction*/ protected string $sortDirection = 'asc'; /** * fromRequestArrayConstruct.*/ public function __construct(array $data = []) { $this->topicId = (int) ($data['topic_id'] ?? 0); $this->page = (int) ($data['page'] ?? 1); $this->pageSize = (int) ($data['page_size'] ?? 20); $this->setSortDirection($data['sort_direction'] ?? 'asc'); } /** * from HTTP RequestObjectCreateInstance.*/ public static function fromRequest(RequestInterface $request): self { $id = $request->route('id'); // From routeParameterGet topic_id return new self([ 'topic_id' => $id, 'page' => $request->input('page', 1), 'page_size' => $request->input('page_size', 20), 'sort_direction' => $request->input('sort_direction', 'asc'), ]); } /** * getTopicID.*/ public function getTopicId(): int { return $this->topicId; } /** * getPage number.*/ public function getPage(): int { return $this->page; } /** * getPage size.*/ public function getPageSize(): int { return $this->pageSize; } /** * getSort direction.*/ public function getSortDirection(): string { return $this->sortDirection; } /** * setSort direction. * * @param string $sortDirection Sort direction * @throws Exception IfSort directionInvalidThen throwAbnormal*/ protected function setSortDirection(string $sortDirection): void { $sortDirection = strtolower(trim($sortDirection)); if (! in_array($sortDirection, self::VALID_SORT_DIRECTIONS, true)) { ExceptionBuilder::throw( GenericErrorCode::ParameterMissing, 'sort_direction.invalid_value' ); } $this->sortDirection = $sortDirection; } } 