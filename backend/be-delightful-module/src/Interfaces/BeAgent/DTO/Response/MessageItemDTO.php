<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Interfaces\BeAgent\DTO\Response; use JsonSerializable; class MessageItemDTO implements JsonSerializable { /** * @var int MessageID*/ protected int $id; /** * @var string RoleType(user/assistant)*/ protected string $role; /** * @var string SenderID*/ protected string $senderUid; /** * @var string ReceiverID*/ protected string $receiverUid; /** * @var string MessageID*/ protected string $messageId; /** * @var string MessageType*/ protected string $type; /** * @var string TaskID*/ protected string $taskId; /** * @var Null|string TaskStatus*/ protected ?string $status; /** * @var string MessageContent*/ protected string $content; /** * @var mixed OriginalMessageContent*/ protected $rawContent; /** * @var Null|array Stepinformation*/ protected ?array $steps; /** * @var Null|array Toolcallinformation*/ protected ?array $tool; /** * @var int SendTimetimestamp*/ protected int $sendTimestamp; /** * @var string EventType*/ protected string $event; /** * @var array Attachmentinformation*/ protected array $attachments; /** * @var Null|string IMStatus (fromdelightful_chat_sequencesTable)*/ protected ?string $imStatus; /** * @var Null|string associatedID, Used forMessagetraceAndassociated*/ protected ?string $correlationId; /** * ConstructFunction.*/ public function __construct(array $data = []) { $this->id = (int) ($data['id'] ?? 0); $this->role = $data['sender_type']; $this->senderUid = (string) ($data['sender_uid'] ?? ''); $this->receiverUid = (string) ($data['receiver_uid'] ?? ''); $this->messageId = (string) ($data['message_id'] ?? ''); $this->type = (string) ($data['type'] ?? ''); $this->taskId = (string) ($data['task_id'] ?? ''); $this->status = $data['status'] ?? Null; $this->content = (string) ($data['content'] ?? ''); // Handle raw_content: Null if empty, json_decode if not empty $rawContentValue = $data['raw_content'] ?? Null; if (empty($rawContentValue)) { $this->rawContent = Null; } else { $this->rawContent = json_decode($rawContentValue, true); } $this->steps = $data['steps'] ?? Null; $this->tool = $data['tool'] ?? Null; $this->sendTimestamp = (int) ($data['send_timestamp'] ?? 0); $this->event = (string) ($data['event'] ?? ''); $this->attachments = $data['attachments'] ?? []; $this->imStatus = isset($data['im_status']) ? $this->convertImStatusToString((int) $data['im_status']) : Null; $this->correlationId = $data['correlation_id'] ?? Null; } /** * Convert toArray.*/ public function toArray(): array { return [ 'id' => $this->id, 'role' => $this->role, 'sender_uid' => $this->senderUid, 'receiver_uid' => $this->receiverUid, 'message_id' => $this->messageId, 'type' => $this->type, 'task_id' => $this->taskId, 'status' => $this->status, 'content' => $this->content, 'raw_content' => $this->rawContent, 'steps' => $this->steps, 'tool' => $this->tool, 'send_timestamp' => $this->sendTimestamp, 'event' => $this->event, 'attachments' => $this->attachments, 'im_status' => $this->imStatus, 'correlation_id' => $this->correlationId, ]; } /** * SequenceConvert toJSON.*/ public function jsonSerialize(): array { return $this->toArray(); } /** * ConvertIMStatusNumberConvert toString (referenceDelightfulMessageStatusEnum).*/ private function convertImStatusToString(int $status): string { return match ($status) { 0 => 'unread', 1 => 'seen', 2 => 'read', 3 => 'revoked', default => 'unread', }; } } 
