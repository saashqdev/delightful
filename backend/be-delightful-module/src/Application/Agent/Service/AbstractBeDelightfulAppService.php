<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Application\Agent\Service; use App\Application\Kernel\AbstractKernelAppService; use App\Application\ModelGateway\MicroAgent\MicroAgentFactory; use App\Domain\Contact\Entity\ValueObject\DataIsolation as ContactDataIsolation; use App\Infrastructure\Core\DataIsolation\BaseDataIsolation; use Delightful\BeDelightful\Domain\Agent\Entity\ValueObject\BeDelightfulAgentDataIsolation; use Delightful\BeDelightful\Domain\Agent\Service\BeDelightfulAgentDomainService; use Hyperf\Logger\LoggerFactory; use Psr\Log\LoggerInterface; use Qbhy\HyperfAuth\Authenticatable; abstract class AbstractBeDelightfulAppService extends AbstractKernelAppService { protected readonly LoggerInterface $logger; public function __construct( protected BeDelightfulAgentDomainService $beDelightfulAgentDomainService, protected MicroAgentFactory $microAgentFactory, protected LoggerFactory $loggerFactory, ) { $this->logger = $this->loggerFactory->get(get_class($this)); } protected function createBeDelightfulDataIsolation(Authenticatable|BaseDataIsolation $authorization): BeDelightfulAgentDataIsolation { $dataIsolation = new BeDelightfulAgentDataIsolation(); if ($authorization instanceof BaseDataIsolation) { $dataIsolation->extends($authorization); return $dataIsolation; } $this->handleByAuthorization($authorization, $dataIsolation); return $dataIsolation; } protected function createContactDataIsolation(Authenticatable|BaseDataIsolation $authorization): ContactDataIsolation { //  first CreateBeDelightfulDataIsolation, thenConvert toContactDataIsolation $beDelightfulDataIsolation = $this->createBeDelightfulDataIsolation($authorization); return $this->createContactDataIsolationByBase($beDelightfulDataIsolation); } } 
