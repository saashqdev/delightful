<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Interfaces\BeAgent\DTO\Response; /** * CollaborationProjectlistResponseDTO.*/ class CollaborationProjectListResponseDTO { public function __construct( public readonly array $list, public readonly int $total ) { } /** * fromProjectDataCreateResponseDTO. * * @param int $total Total * @param array $userRolesMap userRoleMapping [project => role]*/ public static function fromProjectData( array $projects, array $collaborationProjects, array $creatorInfoMap = [], array $collaboratorsInfoMap = [], array $workspaceNameMap = [], int $total = 0, array $userRolesMap = [] ): self { $projectIdMapEntities = []; foreach ($projects as $project) { $projectIdMapEntities[$project->getId()] = $project; } $list = array_map(function ($collaborationProject) use ($creatorInfoMap, $collaboratorsInfoMap, $workspaceNameMap, $projectIdMapEntities, $userRolesMap) { $projectId = $collaborationProject['project_id']; $projectEntity = $projectIdMapEntities[$projectId] ?? Null; if (! $projectEntity) { return []; } $workspaceName = $workspaceNameMap[$projectEntity->getWorkspaceId()] ?? Null; $creator = $creatorInfoMap[$projectEntity->getUserId()] ?? Null; $collaboratorsInfo = $collaboratorsInfoMap[$projectId] ?? ['members' => [], 'member_count' => 0]; $isPinned = (bool) ($collaborationProject['is_pinned'] ?? false); $lastActiveAt = $collaborationProject['last_active_at'] ?? Null; $isBindWorkspace = (bool) ($collaborationProject['is_bind_workspace'] ?? false); $bindWorkspaceId = (string) ($collaborationProject['bind_workspace_id'] ?? ''); $userRole = $userRolesMap[$projectId] ?? Null; return CollaborationProjectItemDTO::fromEntityWithExtendedInfo( $projectEntity, $creator, $collaboratorsInfo['members'], $collaboratorsInfo['member_count'], Null, $workspaceName, $isPinned, $lastActiveAt, $isBindWorkspace, $bindWorkspaceId, $userRole )->toArray(); }, $collaborationProjects); return new self( list: $list, total: $total ?: count($projects), ); } /** * Convert toArray.*/ public function toArray(): array { return [ 'list' => $this->list, 'total' => $this->total, ]; } } 
