<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Domain\SuperAgent\Repository\Facade; use App\Domain\Chat\Entity\ValueObject\DelightfulMessageStatus; use Delightful\BeDelightful\Domain\SuperAgent\Entity\TopicEntity; use Delightful\BeDelightful\Domain\SuperAgent\Entity\ValueObject\TaskStatus; interface TopicRepositoryInterface { /** * throughIDgetTopic.*/ public function getTopicById(int $id): ?TopicEntity; /** * BatchgetTopic. * @return TopicEntity[]*/ public function getTopicsByIds(array $ids): array; public function getTopicWithDeleted(int $id): ?TopicEntity; public function getTopicBySandboxId(string $sandboxId): ?TopicEntity; /** * By/According toConditiongetTopiclist. * SupportFilterã€PaginationAndSort. * * @param array $conditions QueryCondition,  like  ['workspace_id' => 1, 'user_id' => 'xxx'] * @param bool $needPagination whetherNeedPagination * @param int $pageSize PaginationSize * @param int $page Page number * @param string $orderBy Sort field * @param string $orderDirection Sort direction, asc  or  desc * @return array{list: TopicEntity[], total: int} TopiclistAndTotal*/ public function getTopicsByConditions( array $conditions = [], bool $needPagination = true, int $pageSize = 10, int $page = 1, string $orderBy = 'id', string $orderDirection = 'desc' ): array; /** * CreateTopic.*/ public function createTopic(TopicEntity $topicEntity): TopicEntity; /** * UpdateTopic.*/ public function updateTopic(TopicEntity $topicEntity): bool; /** * Useupdated_at AsOptimistic lockUpdateTopic.*/ public function updateTopicWithUpdatedAt(TopicEntity $topicEntity, string $updatedAt): bool; public function updateTopicByCondition(array $condition, array $data): bool; /** * DeleteTopic.*/ public function deleteTopic(int $id): bool; /** * throughTopicIDCollectiongetWorkspaceinformation. * * @param array $topicIds TopicIDCollection * @return array byTopicIDForKey, WorkspaceinformationForValueassociatedArray*/ public function getWorkspaceInfoByTopicIds(array $topicIds): array; /** * getTopicStatusStatisticsData. * * @param array $conditions StatisticsCondition,  like  ['user_id' => '123', 'organization_code' => 'abc'] * @return array containingeachStatusQuantityArray*/ public function getTopicStatusMetrics(array $conditions = []): array; public function updateTopicStatus(int $id, $taskId, TaskStatus $status): bool; public function updateTopicStatusAndSandboxId(int $id, $taskId, TaskStatus $status, string $sandboxId): bool; /** * getRecentUpdated atexceedspecifiedTimeTopiclist. * * @param string $timeThreshold TimethresholdValue, IfTopicUpdated atEarlier than thisTime, Will becontaininginResult in  * @param int $limit ReturnResultMaximumQuantity * @return array<TopicEntity> TopicEntitylist*/ public function getTopicsExceedingUpdateTime(string $timeThreshold, int $limit = 100): array; /** * By/According toProject IDgetTopiclist.*/ public function getTopicsByProjectId(int $projectId, string $userId): array; public function updateTopicStatusBySandboxIds(array $sandboxIds, string $status); /** * StatisticsProject next TopicQuantity.*/ public function countTopicsByProjectId(int $projectId): int; public function getRunningWorkspaceIds(array $workspaceIds, ?string $userId = Null): array; public function getRunningProjectIds(array $projectIds, ?string $userId = Null): array; // ======================= MessageRollbackRelatedmethod ======================= /** * By/According toSequenceIDgetmagic_message_id.*/ public function getDelightfulMessageIdBySeqId(string $seqId): ?string; /** * By/According tomagic_message_idgetAllRelatedseq_id (Allviewrole).*/ public function getAllSeqIdsByDelightfulMessageId(string $magicMessageId): array; /** * By/According toBaseseq_idsgetCurrentTopicCurrentMessageAnd thisMessageafterAllMessage. * @param array $baseSeqIds Baseseq_ids * @return array AllRelatedseq_ids*/ public function getAllSeqIdsFromCurrent(array $baseSeqIds): array; /** * Deletetopic_messagesData.*/ public function deleteTopicMessages(array $seqIds): int; /** * By/According toseq_idsDeletemessagesAndsequencesData.*/ public function deleteMessagesAndSequencesBySeqIds(array $seqIds): bool; /** * By/According toim_seq_idDeletemagic_super_agent_messageTable in Pair should TopicSubsequentMessage. * * DeleteLogic: * 1. By/According toim_seq_idQuerymagic_super_agent_messageTable, getPair should Primary keyidAndtopic_id * 2. DeleteCurrentTopic in id >= Query to Primary keyidAllData * * @param int $seqId IMMessageSequenceID * @return int Number of deleted records*/ public function deleteSuperAgentMessagesFromSeqId(int $seqId): int; /** * BatchUpdatemagic_chat_sequencesTablestatusfield. * * @param array $seqIds NeedUpdateSequenceIDArray * @param DelightfulMessageStatus $status TargetStatus * @return bool UpdatewhetherSuccess*/ public function batchUpdateSeqStatus(array $seqIds, DelightfulMessageStatus $status): bool; /** * By/According toBaseseq_idsgetCurrentTopicLess than inspecifiedseq_idAllMessage. * * @param array $baseSeqIds Baseseq_ids * @return array smallinspecifiedseq_idAllMessagelist*/ public function getAllSeqIdsBeforeCurrent(array $baseSeqIds): array; /** * By/According toTopicIDgetAllWithdrawStatusMessageseq_ids. * * @param int $topicId TopicID * @param string $userId User ID (PermissionValidate) * @return array WithdrawStatusMessageseq_ids*/ public function getRevokedSeqIdsByTopicId(int $topicId, string $userId): array; /** * Batch get topic names by IDs. * * @param array $topicIds Topic ID array * @return array ['topic_id' => 'topic_name'] key-value pairs */ public function getTopicNamesBatch(array $topicIds): array; } 