<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Application\BeAgent\Event\Publish; use Delightful\BeDelightful\Domain\BeAgent\Event\TopicMessageProcessEvent; use Hyperf\Amqp\Annotation\Producer; use Hyperf\Amqp\Message\ProducerMessage; use PhpAmqpLib\Message\AMQPMessage; use PhpAmqpLib\Wire\AMQPTable; /** * TopicMessageProcess/HandlePublishdevice (Lightweight). *  only Notificationconsume person  have MessageNeedProcess/Handle,  not PassSpecificMessageContent.*/ #[Producer(exchange: 'be_delightful_topic_message_process', routingKey: 'be_delightful_topic_message_process')] class TopicMessageProcessPublisher extends ProducerMessage { /** * ConstructFunction.*/ public function __construct(TopicMessageProcessEvent $event) { $this->payload = $event->toArray(); // set AMQP MessageProperty/Attribute $this->properties = [ 'delivery_mode' => AMQPMessage::DELIVERY_MODE_PERSISTENT, // KeepMessagePersistence 'application_headers' => new AMQPTable([ 'x-original-timestamp' => time(), // SetOriginalTimetimestamp（ seconds level） 'x-event-type' => 'topic_message_process', // EventType ]), ]; } } 