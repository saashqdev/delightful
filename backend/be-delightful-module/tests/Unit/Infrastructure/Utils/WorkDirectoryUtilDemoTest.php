<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Tests\Unit\Infrastructure\Utils; use BeDelightful\BeDelightful\Infrastructure\Utils\WorkDirectoryUtil; use PHPUnit\Framework\TestCase; /** * @internal */ class WorkDirectoryUtilDemoTest extends TestCase { public function testWorkDirectoryValidationDemo(): void { $userId = 'user123'; echo "\n" . str_repeat('=', 80) . "\n"; echo "WorkDirectoryUtil Testdemoshow - PathValidateFunction\n"; echo str_repeat('=', 80) . "\n"; $testCases = [ // Legacy format (without /workspace) '/some/path/BE_DELIGHTFUL/user123/project_456' => true, 'BE_DELIGHTFUL/user123/project_789' => true, // New format (with /workspace) '/some/path/BE_DELIGHTFUL/user123/project_456/workspace' => true, 'BE_DELIGHTFUL/user123/project_789/workspace' => true, // With trailing slash '/some/path/BE_DELIGHTFUL/user123/project_456/' => true, '/some/path/BE_DELIGHTFUL/user123/project_456/workspace/' => true, // Invalid cases '' => false, '/some/path/BE_DELIGHTFUL/wronguser/project_456' => false, '/some/path/BE_DELIGHTFUL/user123/project_abc' => false, '/some/path/BE_DELIGHTFUL/user123/project_456/invalid_suffix' => false, '/some/path/BE_DELIGHTFUL/user123/wrongformat' => false, ]; echo sprintf("%-60s | %-8s | %-8s\n", 'TestPath', 'Expectation', 'Actual'); echo str_repeat('-', 80) . "\n"; foreach ($testCases as $path => $expected) { $actual = WorkDirectoryUtil::isValidWorkDirectory($path, $userId); $status = $actual === $expected ? '✅ PASS' : '❌ FAIL'; echo sprintf( "%-60s | %-8s | %-8s %s\n", $path ?: '[EmptyString]', $expected ? 'true' : 'false', $actual ? 'true' : 'false', $status ); $this->assertEquals($expected, $actual, "PathValidation failed: {$path}"); } echo "\n"; } public function testProjectIdExtractionDemo(): void { $userId = 'user123'; echo str_repeat('=', 80) . "\n"; echo "WorkDirectoryUtil Testdemoshow - ProjectIDExtractFunction\n"; echo str_repeat('=', 80) . "\n"; $testCases = [ // Legacy format '/some/path/BE_DELIGHTFUL/user123/project_456' => '456', 'BE_DELIGHTFUL/user123/project_789' => '789', // New format (with /workspace) '/some/path/BE_DELIGHTFUL/user123/project_456/workspace' => '456', 'BE_DELIGHTFUL/user123/project_789/workspace' => '789', // With trailing slash '/some/path/BE_DELIGHTFUL/user123/project_456/' => '456', '/some/path/BE_DELIGHTFUL/user123/project_456/workspace/' => '456', // Large project ID '/some/path/BE_DELIGHTFUL/user123/project_123456789/workspace' => '123456789', // Invalid cases '' => Null, '/some/path/BE_DELIGHTFUL/wronguser/project_456' => Null, '/some/path/BE_DELIGHTFUL/user123/project_abc' => Null, '/some/path/BE_DELIGHTFUL/user123/project_456/invalid_suffix' => Null, '/some/path/BE_DELIGHTFUL/user123/wrongformat' => Null, ]; echo sprintf("%-60s | %-10s | %-10s\n", 'TestPath', 'ExpectationID', 'ExtractID'); echo str_repeat('-', 80) . "\n"; foreach ($testCases as $path => $expectedId) { $actualId = WorkDirectoryUtil::extractProjectIdFromAbsolutePathLegacy($path, $userId); $status = $actualId === $expectedId ? '✅ PASS' : '❌ FAIL'; echo sprintf( "%-60s | %-10s | %-10s %s\n", $path ?: '[EmptyString]', $expectedId ?: 'Null', $actualId ?: 'Null', $status ); $this->assertEquals($expectedId, $actualId, "ProjectIDExtractFailed: {$path}"); } echo "\n"; } public function testCompatibilityDemo(): void { echo str_repeat('=', 80) . "\n"; echo "WorkDirectoryUtil Testdemoshow - Backward compatibilityValidate\n"; echo str_repeat('=', 80) . "\n"; $userId = 'testuser'; $projectId = 12345; // Use existingmethodGeneratePath $legacyPath = WorkDirectoryUtil::getRootDir($userId, $projectId); $newPath = WorkDirectoryUtil::getWorkDir($userId, $projectId); echo "GeneratePath:\n"; echo sprintf("LegacyFormat (getRootDir): %s\n", $legacyPath); echo sprintf(" new Format (getWorkDir): %s\n", $newPath); echo "\n"; $testData = [ ['PathType', 'Path', 'ValidateResult', 'ExtractID', 'Status'], ['Legacy', $legacyPath, WorkDirectoryUtil::isValidWorkDirectory($legacyPath, $userId), WorkDirectoryUtil::extractProjectIdFromAbsolutePathLegacy($legacyPath, $userId), ''], [' new Format', $newPath, WorkDirectoryUtil::isValidWorkDirectory($newPath, $userId), WorkDirectoryUtil::extractProjectIdFromAbsolutePathLegacy($newPath, $userId), ''], ]; foreach ($testData as $index => $row) { if ($index === 0) { echo sprintf("%-8s | %-50s | %-8s | %-8s | %-8s\n", ...$row); echo str_repeat('-', 80) . "\n"; } else { $status = ($row[2] && $row[3] == $projectId) ? '✅ PASS' : '❌ FAIL'; echo sprintf( "%-8s | %-50s | %-8s | %-8s | %-8s\n", $row[0], $row[1], $row[2] ? 'true' : 'false', $row[3] ?: 'Null', $status ); // AssertValidate $this->assertTrue($row[2], "PathValidation failed: {$row[1]}"); $this->assertEquals((string) $projectId, $row[3], "ProjectIDExtractFailed: {$row[1]}"); } } echo "\nTestSummary: New and oldFormatallcancorrectValidateAndExtractProjectID ✅\n"; echo str_repeat('=', 80) . "\n"; } } 