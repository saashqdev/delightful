<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Application\BeAgent\Service; use App\Infrastructure\Util\Context\RequestContext; use Delightful\BeDelightful\Domain\BeAgent\Service\FileEditingDomainService; use Delightful\BeDelightful\Domain\BeAgent\Service\TaskFileDomainService; /** * FileEditStatusApplicationService*/ class FileEditingAppService extends AbstractAppService { public function __construct( private readonly FileEditingDomainService $fileEditingDomainService, private readonly TaskFileDomainService $taskFileDomainService, ) { } /** * JoinEdit.*/ public function joinEditing(RequestContext $requestContext, int $fileId): void { $userAuthorization = $requestContext->getUserAuthorization(); // PermissionCheck $fileEntity = $this->taskFileDomainService->getUserFileEntityNoUser($fileId); $projectEntity = $this->getAccessibleProjectWithEditor($fileEntity->getProjectId(), $userAuthorization->getId(), $userAuthorization->getOrganizationCode()); // delegateDomainLayer processingbusiness logic $this->fileEditingDomainService->joinEditing($fileId, $userAuthorization->getId(), $projectEntity->getUserOrganizationCode()); } /** * leaveEdit.*/ public function leaveEditing(RequestContext $requestContext, int $fileId): void { $userAuthorization = $requestContext->getUserAuthorization(); // PermissionCheck $fileEntity = $this->taskFileDomainService->getUserFileEntityNoUser($fileId); $projectEntity = $this->getAccessibleProjectWithEditor($fileEntity->getProjectId(), $userAuthorization->getId(), $userAuthorization->getOrganizationCode()); // delegateDomainLayer processingbusiness logic $this->fileEditingDomainService->leaveEditing($fileId, $userAuthorization->getId(), $projectEntity->getUserOrganizationCode()); } /** * getEdituserQuantity.*/ public function getEditingUsers(RequestContext $requestContext, int $fileId): int { $userAuthorization = $requestContext->getUserAuthorization(); // PermissionCheck $fileEntity = $this->taskFileDomainService->getUserFileEntityNoUser($fileId); $projectEntity = $this->getAccessibleProject($fileEntity->getProjectId(), $userAuthorization->getId(), $userAuthorization->getOrganizationCode()); // delegateDomainlayerQueryEdituserQuantity return $this->fileEditingDomainService->getEditingUsersCount($fileId, $projectEntity->getUserOrganizationCode()); } } 