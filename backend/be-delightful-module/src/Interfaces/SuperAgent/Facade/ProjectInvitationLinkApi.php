<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Interfaces\BeAgent\Facade; use App\Infrastructure\Util\Context\RequestContext; use BeDelightful\ApiResponse\Annotation\ApiResponse; use BeDelightful\BeDelightful\Application\BeAgent\Service\ProjectInvitationLinkAppService; use Hyperf\HttpServer\Contract\RequestInterface; /** * ProjectInvitation linkAPI. * * unifiedmanagementProjectInvitation linkmanagementAndaccessedFunction*/ #[ApiResponse('low_code')] class ProjectInvitationLinkApi extends AbstractApi { public function __construct( protected ProjectInvitationLinkAppService $invitationLinkAppService, protected RequestInterface $request, ) { parent::__construct($request); } /** * getProjectInvitation linkinformation.*/ public function getInvitationLink(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $result = $this->invitationLinkAppService->getInvitationLink($requestContext, $projectId); return $result ? $result->toArray() : []; } /** * Enable/Close invitation link.*/ public function toggleInvitationLink(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $enabled = (bool) $this->request->input('enabled', false); return $this->invitationLinkAppService->toggleInvitationLink($requestContext, $projectId, $enabled)->toArray(); } /** * ResetInvitation link.*/ public function resetInvitationLink(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); return $this->invitationLinkAppService->resetInvitationLink($requestContext, $projectId)->toArray(); } /** * setpasswordProtect.*/ public function setPassword(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $enabled = (bool) $this->request->input('enabled', false); $password = $this->invitationLinkAppService->setPassword($requestContext, $projectId, $enabled); return ['password' => $password]; } /** *  re setpassword*/ public function resetPassword(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $password = $this->invitationLinkAppService->resetPassword($requestContext, $projectId); return ['password' => $password]; } /** * ModifyInvitation linkpassword*/ public function changePassword(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $newPassword = $this->request->input('password', ''); $password = $this->invitationLinkAppService->changePassword($requestContext, $projectId, $newPassword); return ['password' => $password]; } /** * ModifyPermissionGrade.*/ public function updateDefaultJoinPermission(RequestContext $requestContext, int $projectId): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $permission = $this->request->input('default_join_permission', 'viewer'); $this->invitationLinkAppService->updateDefaultJoinPermission($requestContext, $projectId, $permission); return ['default_join_permission' => $permission]; } /** * throughTokenaccessedInvitation link.*/ public function getInvitationByToken(RequestContext $requestContext, string $token): array { // Externaluseraccessed, But still needset user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); return $this->invitationLinkAppService->getInvitationByToken($requestContext, $token)->toArray(); } /** * JoinProject (ExternaluserOperation).*/ public function joinProject(RequestContext $requestContext): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); $token = $this->request->input('token', ''); $password = $this->request->input('password'); return $this->invitationLinkAppService->joinProject($requestContext, $token, $password)->toArray(); } } 