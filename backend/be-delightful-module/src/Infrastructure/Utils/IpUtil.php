<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Infrastructure\Utils; use Hyperf\HttpServer\Contract\RequestInterface; /** * IPAddressgetTool.*/ class IpUtil { /** * getClientIPAddress * * @param RequestInterface $request HTTPRequestObject * @return Null|string ClientIPAddress*/ public static function getClientIpAddress(RequestInterface $request): ?string { // PrioritySequential: X-Real-IP -> X-Forwarded-For -> remote_addr $realIp = $request->getHeaderLine('x-real-ip'); if (! empty($realIp)) { return $realIp; } $forwardedFor = $request->getHeaderLine('x-forwarded-for'); if (! empty($forwardedFor)) { // X-Forwarded-For May/PossiblecontainingmultipleIP, Take first $ips = explode(',', $forwardedFor); return trim($ips[0]); } $serverParams = $request->getServerParams(); return $serverParams['remote_addr'] ?? Null; } } 
