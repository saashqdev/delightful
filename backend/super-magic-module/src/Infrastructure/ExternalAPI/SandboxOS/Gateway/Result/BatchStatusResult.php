<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Dtyq\SuperMagic\Infrastructure\ExternalAPI\SandboxOS\Gateway\Result; use Dtyq\SuperMagic\Infrastructure\ExternalAPI\SandboxOS\Gateway\Constant\SandboxStatus; /** * BatchSandboxStatusResultClass * Specially handleBatchSandboxStatusQueryResult.*/ class BatchStatusResult extends GatewayResult { private array $sandboxStatuses = []; /** * fromAPIResponseCreateBatchStatusResult.*/ public static function fromApiResponse(array $response): self { $result = new self( $response['code'] ?? 2000, $response['message'] ?? 'Unknown error', $response['data'] ?? [] ); // parseBatchStatusData // By/According toDocument, data fielddirectly is SandboxStatusArray $data = $response['data'] ?? []; if (is_array($data)) { $result->sandboxStatuses = $data; } return $result; } /** * getAllSandboxStatus*/ public function getSandboxStatuses(): array { return $this->sandboxStatuses ?: $this->getData(); } /** * getspecifiedSandboxStatus*/ public function getSandboxStatus(string $sandboxId): ?string { $statuses = $this->getSandboxStatuses(); foreach ($statuses as $sandbox) { if (isset($sandbox['sandbox_id']) && $sandbox['sandbox_id'] === $sandboxId) { return $sandbox['status'] ?? Null; } } return Null; } /** * CheckspecifiedSandboxwhetherRun in .*/ public function isSandboxRunning(string $sandboxId): bool { $status = $this->getSandboxStatus($sandboxId); return $status !== Null && SandboxStatus::isAvailable($status); } /** * getRunSandbox inlist.*/ public function getRunningSandboxes(): array { $running = []; $statuses = $this->getSandboxStatuses(); foreach ($statuses as $sandbox) { if (isset($sandbox['status']) && SandboxStatus::isAvailable($sandbox['status'])) { $running[] = $sandbox; } } return $running; } /** * getRunSandbox inIDlist.*/ public function getRunningSandboxIds(): array { $ids = []; $running = $this->getRunningSandboxes(); foreach ($running as $sandbox) { if (isset($sandbox['sandbox_id'])) { $ids[] = $sandbox['sandbox_id']; } } return $ids; } /** * getSandboxTotal.*/ public function getTotalCount(): int { return count($this->getSandboxStatuses()); } /** * getRunSandbox inQuantity.*/ public function getRunningCount(): int { return count($this->getRunningSandboxes()); } } 