<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Application\Share\Adapter; use BeDelightful\BeDelightful\Application\Share\DTO\ShareableResourceDTO; use BeDelightful\BeDelightful\Application\Share\Factory\Facade\ResourceFactoryInterface; use BeDelightful\BeDelightful\Application\BeAgent\Service\WorkspaceAppService; use Exception; class TopicShareableResource implements ResourceFactoryInterface { public function __construct(private readonly WorkspaceAppService $workspaceAppService) { } public function createResource(string $resourceId, string $userId, string $organizationCode): ShareableResourceDTO { //  first Querywhether store in return new ShareableResourceDTO(); } public function isResourceShareable(string $resourceId, string $organizationCode): bool { // targetbeforeAllTopicallableshare return true; } public function hasSharePermission(string $resourceId, string $userId, string $organizationCode): bool { // targetbeforeNo/NonesharePermission return true; } public function getResourceContent(string $resourceId, string $userId, string $organizationCode, int $page, int $pageSize): array { $result = $this->workspaceAppService->getMessagesByTopicId((int) $resourceId, $page, $pageSize); if (empty($result)) { return []; } return $result; } public function getResourceName(string $resourceId): string { return $this->workspaceAppService->getTopicDetail((int) $resourceId); } public function getResourceExtendList(array $list): array { // Extract resource_id, resource_id  is Topic id $topicIds = array_column($list, 'resource_id'); if (empty($topicIds)) { return $list; } // through Topic id Collection, QueryoutputWorkspaceNameAndWorkspace ID try { $workspaceInfo = $this->workspaceAppService->getWorkspaceInfoByTopicIds($topicIds); // through for loop ConvertWorkspaceNameAndWorkspace IDassemble together come foreach ($list as &$item) { $resourceId = $item['resource_id']; $item['extend'] = []; if (isset($workspaceInfo[$resourceId])) { $item['extend'] = [ 'workspace_id' => $workspaceInfo[$resourceId]['workspace_id'] ?? '', 'workspace_name' => $workspaceInfo[$resourceId]['workspace_name'] ?? '', ]; } } return $list; } catch (Exception $e) { // RecordErrorLogBut not affectNormalProcess return $list; } } } 