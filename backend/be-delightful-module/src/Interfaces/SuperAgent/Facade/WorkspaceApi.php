<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Interfaces\BeAgent\Facade; use App\Infrastructure\Core\Exception\BusinessException; use App\Infrastructure\Util\Context\RequestContext; use Delightful\ApiResponse\Annotation\ApiResponse; use Delightful\BeDelightful\Application\BeAgent\Service\TopicAppService; use Delightful\BeDelightful\Application\BeAgent\Service\WorkspaceAppService; use Delightful\BeDelightful\Domain\BeAgent\Entity\ValueObject\WorkspaceArchiveStatus; use Delightful\BeDelightful\Interfaces\BeAgent\DTO\Request\GetWorkspaceTopicsRequestDTO; use Delightful\BeDelightful\Interfaces\BeAgent\DTO\Request\SaveWorkspaceRequestDTO; use Delightful\BeDelightful\Interfaces\BeAgent\DTO\Request\WorkspaceListRequestDTO; use Hyperf\HttpServer\Contract\RequestInterface; use Throwable; #[ApiResponse('low_code')] class WorkspaceApi extends AbstractApi { public function __construct( protected RequestInterface $request, protected WorkspaceAppService $workspaceAppService, protected TopicAppService $topicAppService, ) { parent::__construct($request); } /** * getWorkspacelist.*/ public function getWorkspaceList(RequestContext $requestContext): array { // set user authorization information $requestContext->setAuthorization($this->request->header('authorization', '')); $requestContext->setUserAuthorization($this->getAuthorization()); // fromRequestCreateDTO $requestDTO = WorkspaceListRequestDTO::fromRequest($this->request); // callApplicationService return $this->workspaceAppService->getWorkspaceList($requestContext, $requestDTO)->toArray(); } /** * getWorkspaceDetails.*/ public function getWorkspaceDetail(RequestContext $requestContext, string $id): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // callApplicationService return $this->workspaceAppService->getWorkspaceDetail($requestContext, (int) $id)->toArray(); } /** * getWorkspace next Topiclist.*/ public function getWorkspaceTopics(RequestContext $requestContext): array { $requestContext->setUserAuthorization($this->getAuthorization()); $dto = GetWorkspaceTopicsRequestDTO::fromRequest($this->request); return $this->workspaceAppService->getWorkspaceTopics( $requestContext, $dto )->toArray(); } public function createWorkspace(RequestContext $requestContext): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // fromRequestCreateDTO $requestDTO = SaveWorkspaceRequestDTO::fromRequest($this->request); // callApplicationServiceLayer processingbusiness logic return $this->workspaceAppService->createWorkspace($requestContext, $requestDTO)->toArray(); } public function updateWorkspace(RequestContext $requestContext, string $id): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // fromRequestCreateDTO $requestDTO = SaveWorkspaceRequestDTO::fromRequest($this->request); $requestDTO->id = $id; // callApplicationServiceLayer processingbusiness logic return $this->workspaceAppService->updateWorkspace($requestContext, $requestDTO)->toArray(); } /** * SaveWorkspace (Create orUpdate). * InterfaceLayer responsibleProcess/HandleHTTPRequestAndResponse,  not containingbusiness logic. * @throws Throwable*/ public function saveWorkspace(RequestContext $requestContext): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // fromRequestCreateDTO $requestDTO = SaveWorkspaceRequestDTO::fromRequest($this->request); // callApplicationServiceLayer processingbusiness logic return $this->workspaceAppService->saveWorkspace($requestContext, $requestDTO)->toArray(); } /** * DeleteWorkspace (LogicDelete). * InterfaceLayer responsibleProcess/HandleHTTPRequestAndResponse,  not containingbusiness logic. * * @param RequestContext $requestContext request context * @return array OperationResult * @throws BusinessException throws exception if parameters are invalid or operation fails*/ public function deleteWorkspace(RequestContext $requestContext, string $id): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // callApplicationServiceLayer processingbusiness logic $this->workspaceAppService->deleteWorkspace($requestContext, (int) $id); // ReturnnormalizeResponseResult return ['id' => $id]; } /** * setWorkspaceArchiveStatus. * * @param RequestContext $requestContext request context * @return array OperationResult * @throws BusinessException throws exception if parameters are invalid or operation fails*/ public function setArchived(RequestContext $requestContext): array { // set user authorization information $requestContext->setUserAuthorization($this->getAuthorization()); // getRequestParameter $workspaceIds = $this->request->input('workspace_ids', []); $isArchived = (int) $this->request->input('is_archived', WorkspaceArchiveStatus::NotArchived->value); // callApplicationServicelayersetArchiveStatus $result = $this->workspaceAppService->setWorkspaceArchived($requestContext, $workspaceIds, $isArchived); // ReturnnormalizeResponseResult return [ 'success' => $result, ]; } } 