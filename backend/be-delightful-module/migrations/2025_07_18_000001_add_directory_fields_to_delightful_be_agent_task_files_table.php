<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ use Hyperf\Database\Migrations\Migration; use Hyperf\Database\Schema\Blueprint; use Hyperf\Database\Schema\Schema; return new class extends Migration { /** * Run the migrations. */ public function up(): void { // addDirectorymanagementeach otherrelated tofieldto delightful_super_agent_task_files table if (Schema::hasTable('delightful_super_agent_task_files')) { Schema::table('delightful_super_agent_task_files', function (Blueprint $table) { // add is_directory field - whetherasDirectory if (! Schema::hasColumn('delightful_super_agent_task_files', 'is_directory')) { $table->tinyInteger('is_directory')->default(0)->comment('yesnoasDirectory: 0-no, 1-yes'); } // add sort field - Sort field if (! Schema::hasColumn('delightful_super_agent_task_files', 'sort')) { $table->bigInteger('sort')->default(0)->comment('sort orderfield'); } // add parent_id field - ParentID if (! Schema::hasColumn('delightful_super_agent_task_files', 'parent_id')) { $table->unsignedBigInteger('parent_id')->Nullable()->comment('parent ID'); } // add source field - sourcefield if (! Schema::hasColumn('delightful_super_agent_task_files', 'source')) { $table->tinyInteger('source')->default(0)->comment('sourcefield: 1-homepage, 2-ProjectDirectory, 3-agent'); } // add index $table->index('parent_id', 'idx_parent_id'); $table->index('source', 'idx_source'); $table->index('sort', 'idx_sort'); $table->index('is_directory', 'idx_is_directory'); }); } } /** * Reverse the migrations. */ public function down(): void { // RollbackOperation if (Schema::hasTable('delightful_super_agent_task_files')) { Schema::table('delightful_super_agent_task_files', function (Blueprint $table) { // Deleteindex try { $table->dropIndex('idx_parent_id'); $table->dropIndex('idx_source'); $table->dropIndex('idx_sort'); $table->dropIndex('idx_is_directory'); } catch (Exception $e) { // indexMay not existin, ignoreError } // Deletefield if (Schema::hasColumn('delightful_super_agent_task_files', 'is_directory')) { $table->dropColumn('is_directory'); } if (Schema::hasColumn('delightful_super_agent_task_files', 'sort')) { $table->dropColumn('sort'); } if (Schema::hasColumn('delightful_super_agent_task_files', 'parent_id')) { $table->dropColumn('parent_id'); } if (Schema::hasColumn('delightful_super_agent_task_files', 'source')) { $table->dropColumn('source'); } }); } } }; 
