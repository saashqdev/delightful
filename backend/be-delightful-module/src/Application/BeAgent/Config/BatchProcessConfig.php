<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Application\BeAgent\Config; /** * Batch Process Configuration. * BatchProcess/HandleconfigurationClass - unifiedmanagementBatchFileSaveEachParameter.*/ class BatchProcessConfig { /** * ConcurrentControlconfiguration.*/ public const int DEFAULT_MAX_CONCURRENCY = 5; // DefaultMaximumConcurrent count （considerFileIOAnd memory usage） public const int MIN_CONCURRENCY = 1; // MinimumConcurrent count  public const int MAX_CONCURRENCY = 8; // MaximumConcurrentCount limit（FileProcess/HandleShould not be too high） /** * BatchSizeLimit.*/ public const int DEFAULT_BATCH_SIZE_LIMIT = 50; // DefaultBatchSizeLimit public const int MAX_BATCH_SIZE_LIMIT = 100; // MaximumBatchSizeUpper limit /** * Functionswitch.*/ public const bool ENABLE_PERFORMANCE_MONITORING = true; // PerformanceMonitorswitch public const bool ENABLE_DETAILED_LOGGING = true; // detailedLogswitch /** * getMaximumConcurrent count . * FileProcess/Handle is IOintensiveSettypeOperation, Needconsiderinner store occupyuseAndSystemResourceLimit. * * @param int $fileCount FileQuantity * @return int ActualConcurrent count */ public static function getMaxConcurrency(int $fileCount): int { // FileProcess/HandleConcurrentStrategy: // 1. consider to everyFileMaximum10MB, overmultipleConcurrentWill occupy lots of memory // 2. FileUploadinvolveTemporaryFile、NetworkIO, Resourcemessageconsumecomparebig // 3. Distribute style  lock 、Data database Connectwaitalso have Limit if ($fileCount == 1) { return 1; } if ($fileCount <= 3) { return 3; // few amount Fileuse3 each Concurrent } // No matter how manyFile, MaximumConcurrentCount not exceed5 return self::DEFAULT_MAX_CONCURRENCY; } /** * whetherEnableConcurrentProcess/Handle. * * @param int $fileCount FileQuantity * @return bool whetherEnableConcurrent*/ public static function shouldEnableConcurrency(int $fileCount): bool { // FileQuantitysmallin2 time  not UseConcurrent return $fileCount >= 2; } /** * getBatchSizeLimit. * * @return int BatchSizeLimit*/ public static function getBatchSizeLimit(): int { return self::DEFAULT_BATCH_SIZE_LIMIT; } /** * whetherEnablePerformanceMonitor. * * @return bool whetherEnablePerformanceMonitor*/ public static function isPerformanceMonitoringEnabled(): bool { return self::ENABLE_PERFORMANCE_MONITORING; } /** * whetherEnabledetailedLog. * * @return bool whetherEnabledetailedLog*/ public static function isDetailedLoggingEnabled(): bool { return self::ENABLE_DETAILED_LOGGING; } } 