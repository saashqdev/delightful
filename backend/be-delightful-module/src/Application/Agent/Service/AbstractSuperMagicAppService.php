<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\SuperDelightful\Application\Agent\Service; use App\Application\Kernel\AbstractKernelAppService; use App\Application\ModelGateway\MicroAgent\MicroAgentFactory; use App\Domain\Contact\Entity\ValueObject\DataIsolation as ContactDataIsolation; use App\Infrastructure\Core\DataIsolation\BaseDataIsolation; use Delightful\SuperDelightful\Domain\Agent\Entity\ValueObject\SuperDelightfulAgentDataIsolation; use Delightful\SuperDelightful\Domain\Agent\Service\SuperDelightfulAgentDomainService; use Hyperf\Logger\LoggerFactory; use Psr\Log\LoggerInterface; use Qbhy\HyperfAuth\Authenticatable; abstract class AbstractSuperDelightfulAppService extends AbstractKernelAppService { protected readonly LoggerInterface $logger; public function __construct( protected SuperDelightfulAgentDomainService $superDelightfulAgentDomainService, protected MicroAgentFactory $microAgentFactory, protected LoggerFactory $loggerFactory, ) { $this->logger = $this->loggerFactory->get(get_class($this)); } protected function createSuperDelightfulDataIsolation(Authenticatable|BaseDataIsolation $authorization): SuperDelightfulAgentDataIsolation { $dataIsolation = new SuperDelightfulAgentDataIsolation(); if ($authorization instanceof BaseDataIsolation) { $dataIsolation->extends($authorization); return $dataIsolation; } $this->handleByAuthorization($authorization, $dataIsolation); return $dataIsolation; } protected function createContactDataIsolation(Authenticatable|BaseDataIsolation $authorization): ContactDataIsolation { //  first CreateSuperDelightfulDataIsolation, thenConvert toContactDataIsolation $superDelightfulDataIsolation = $this->createSuperDelightfulDataIsolation($authorization); return $this->createContactDataIsolationByBase($superDelightfulDataIsolation); } } 