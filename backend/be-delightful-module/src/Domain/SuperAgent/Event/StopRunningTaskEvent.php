<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Domain\SuperAgent\Event; use Delightful\BeDelightful\Domain\SuperAgent\Entity\ValueObject\DeleteDataType; /** * StopRun in TaskEvent * whenWorkspace、Project or Topic be Delete time Trigger, Used forAsyncStopRelatedRun in Task*/ class StopRunningTaskEvent extends AbstractEvent { /** * ConstructFunction. * * @param DeleteDataType $dataType DataType (Workspace、Project、Topic) * @param int $dataId DataID * @param string $userId User ID * @param string $organizationCode Organization code * @param string $reason Stoporiginalbecause*/ public function __construct( private DeleteDataType $dataType, private int $dataId, private string $userId, private string $organizationCode, private string $reason = '' ) { // Call parent constructor to generate snowflake ID parent::__construct(); // Set default reason if not provided if (empty($this->reason)) { $this->reason = "Related {$this->dataType->getDescription()} has been deleted"; } } /** * fromArrayCreateEvent. * * @param array $data Event data array*/ public static function fromArray(array $data): self { $dataType = DeleteDataType::from($data['data_type'] ?? DeleteDataType::TOPIC->value); $dataId = (int) ($data['data_id'] ?? 0); $userId = (string) ($data['user_id'] ?? ''); $organizationCode = (string) ($data['organization_code'] ?? ''); $reason = (string) ($data['reason'] ?? ''); return new self($dataType, $dataId, $userId, $organizationCode, $reason); } /** * Convert toArray. * * @return array Event data array*/ public function toArray(): array { return [ 'event_id' => $this->getEventId(), 'data_type' => $this->dataType->value, 'data_id' => $this->dataId, 'user_id' => $this->userId, 'organization_code' => $this->organizationCode, 'reason' => $this->reason, 'timestamp' => time(), ]; } /** * getDataType.*/ public function getDataType(): DeleteDataType { return $this->dataType; } /** * getDataID.*/ public function getDataId(): int { return $this->dataId; } /** * getUser ID. */ public function getUserId(): string { return $this->userId; } /** * getOrganization code.*/ public function getOrganizationCode(): string { return $this->organizationCode; } /** * getStoporiginalbecause.*/ public function getReason(): string { return $this->reason; } } 