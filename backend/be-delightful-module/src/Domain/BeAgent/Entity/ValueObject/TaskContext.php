<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\BeDelightful\Domain\BeAgent\Entity\ValueObject; use App\Domain\Chat\DTO\Message\Common\MessageExtra\BeAgent\BeAgentExtra; use App\Domain\Contact\Entity\ValueObject\DataIsolation; use Delightful\BeDelightful\Domain\BeAgent\Entity\TaskEntity; /** * TaskcontextObject, Used forencapsulateTaskRelatedcontextParameter. * * thisClassIs aImmutableValueObject, matchDDDDesignMode*/ class TaskContext { /** * @param TaskEntity $task TaskEntity * @param DataIsolation $dataIsolation DataIsolationObject * @param string $chatConversationId ChatSessionID * @param string $chatTopicId ChatTopicID * @param string $agentUserId AgentUser ID * @param string $sandboxId SandboxID * @param string $taskId TaskID * @param ChatInstruction $instruction ChatInstruction * @param string $agentMode AgentMode * @param array $mcpConfig MCPconfiguration * @param string $workspaceId Workspace ID * @param string $messageId MessageID * @param bool $isFirstTask whetherFor first timeTask * @param Null|BeAgentExtra $extra ExtensionParameter*/ public function __construct( private readonly TaskEntity $task, private readonly DataIsolation $dataIsolation, private readonly string $chatConversationId, private readonly string $chatTopicId, private readonly string $agentUserId, private string $sandboxId = '', private string $taskId = '', private ChatInstruction $instruction = ChatInstruction::Normal, private string $agentMode = '', private array $mcpConfig = [], private string $modelId = '', private array $dynamicConfig = [], private string $workspaceId = '', private string $messageId = '', private bool $isFirstTask = false, private ?BeAgentExtra $extra = Null, ) { } /** * getTaskEntity.*/ public function getTask(): TaskEntity { return $this->task; } /** * getDataIsolationObject*/ public function getDataIsolation(): DataIsolation { return $this->dataIsolation; } /** * getChatSessionID.*/ public function getChatConversationId(): string { return $this->chatConversationId; } /** * getChatTopicID.*/ public function getChatTopicId(): string { return $this->chatTopicId; } /** * getAgentUser ID. */ public function getAgentUserId(): string { return $this->agentUserId; } /** * getSandboxID.*/ public function getSandboxId(): string { return $this->sandboxId; } /** * getTaskID.*/ public function getTaskId(): string { return $this->taskId ?: $this->task->getTaskId(); } /** * getOriginalTaskID (fromTaskEntityget from).*/ public function getOriginalTaskId(): string { return $this->task->getTaskId(); } /** * getTaskEntityID.*/ public function getTaskEntityId(): int { return $this->task->getId(); } /** * getTaskTopicID.*/ public function getTopicId(): int { return $this->task->getTopicId(); } /** * getProject ID.*/ public function getProjectId(): int { return $this->task->getProjectId(); } /** * getCurrent user ID.*/ public function getCurrentUserId(): string { return $this->dataIsolation->getCurrentUserId(); } /** * getCurrentOrganization code*/ public function getCurrentOrganizationCode(): string { return $this->dataIsolation->getCurrentOrganizationCode(); } /** * getChatInstruction.*/ public function getInstruction(): ChatInstruction { return $this->instruction; } /** * getAgentMode.*/ public function getAgentMode(): string { return $this->agentMode; } public function getMcpConfig(): array { return $this->mcpConfig; } /** * Create aWith newTaskbutReserveOtherParametercontext.*/ public function withTask(TaskEntity $newTask): self { return new self( $newTask, $this->dataIsolation, $this->chatConversationId, $this->chatTopicId, $this->agentUserId, $this->sandboxId, $this->taskId, $this->instruction, $this->agentMode, $this->mcpConfig, $this->modelId, $this->dynamicConfig, $this->workspaceId, $this->messageId, $this->isFirstTask, $this->extra, ); } public function setTaskId(string $taskId): self { $this->taskId = $taskId; return $this; } public function setSandboxId(string $sandboxId): self { $this->sandboxId = $sandboxId; return $this; } public function setInstruction(ChatInstruction $instruction): self { $this->instruction = $instruction; return $this; } public function setAgentMode(string $agentMode): self { $this->agentMode = $agentMode; return $this; } public function setMcpConfig(array $mcpConfig): self { $this->mcpConfig = $mcpConfig; return $this; } public function getModelId(): string { return $this->modelId; } public function setModelId(string $modelId): self { $this->modelId = $modelId; return $this; } public function getDynamicConfig(): array { if (! empty($this->modelId) && empty($this->dynamicConfig['models'][$this->getModelId()])) { // adddefaultconfiguration $this->dynamicConfig['models'][$this->getModelId()] = [ 'api_key' => '${DELIGHTFUL_API_KEY}', 'api_base_url' => '${DELIGHTFUL_API_BASE_URL}', 'name' => $this->getModelId(), ]; } return $this->dynamicConfig; } public function setDynamicConfig(array $dynamicConfig): self { $this->dynamicConfig = $dynamicConfig; return $this; } public function setWorkspaceId(string $workspaceId): self { $this->workspaceId = $workspaceId; return $this; } public function getWorkspaceId(): string { return $this->workspaceId; } /** * getMessageID.*/ public function getMessageId(): string { return $this->messageId; } /** * setMessageID.*/ public function setMessageId(string $messageId): self { $this->messageId = $messageId; return $this; } /** * getwhetherFor first timeTask.*/ public function getIsFirstTask(): bool { return $this->isFirstTask; } /** * setwhetherFor first timeTask.*/ public function setIsFirstTask(bool $isFirstTask): self { $this->isFirstTask = $isFirstTask; return $this; } /** * getExtensionParameter.*/ public function getExtra(): ?BeAgentExtra { return $this->extra; } /** * setExtensionParameter.*/ public function setExtra(?BeAgentExtra $extra): self { $this->extra = $extra; return $this; } } 
