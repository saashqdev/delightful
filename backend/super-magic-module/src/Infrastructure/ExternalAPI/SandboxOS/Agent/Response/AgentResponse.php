<?php declare(strict_types=1); /** * Copyright (c) Be Delightful , Distributed under the MIT software license */ namespace Delightful\SuperMagic\Infrastructure\ExternalAPI\SandboxOS\Agent\Response; use Delightful\SuperMagic\Infrastructure\ExternalAPI\SandboxOS\Gateway\Result\GatewayResult; /** * AgentResponseClass * encapsulateAgent APIResponseData.*/ class AgentResponse extends GatewayResult { private ?string $agentId = Null; private ?string $sessionId = Null; private ?string $messageId = Null; private ?string $responseMessage = Null; private ?string $responseType = Null; private array $responseMetadata = []; /** * fromGatewayResultCreateAgentResponse.*/ public static function fromGatewayResult(GatewayResult $gatewayResult): self { $response = new self( $gatewayResult->getCode(), $gatewayResult->getMessage(), $gatewayResult->getData() ); // parseAgentspecificResponseData $data = $gatewayResult->getData(); $response->parseAgentData($data); return $response; } /** * fromAPIResponseCreateAgentResponse.*/ public static function fromApiResponse(array $response): self { $agentResponse = new self( $response['code'] ?? 2000, $response['message'] ?? 'Unknown error', $response['data'] ?? [] ); $agentResponse->parseAgentData($response['data'] ?? []); return $agentResponse; } /** * getAgent ID. */ public function getAgentId(): ?string { return $this->agentId ?? $this->getDataValue('agent_id'); } /** * getSessionID.*/ public function getSessionId(): ?string { return $this->sessionId ?? $this->getDataValue('session_id'); } /** * getMessageID.*/ public function getMessageId(): ?string { return $this->messageId ?? $this->getDataValue('message_id'); } /** * getResponseMessage.*/ public function getResponseMessage(): ?string { return $this->responseMessage ?? $this->getDataValue('response'); } /** * getResponseType.*/ public function getResponseType(): ?string { return $this->responseType ?? $this->getDataValue('response_type'); } /** * getResponse element Data.*/ public function getResponseMetadata(): array { return $this->responseMetadata ?: ($this->getDataValue('metadata', [])); } /** * getspecified element DataValue*/ public function getMetadataValue(string $key, mixed $default = Null): mixed { $metadata = $this->getResponseMetadata(); return $metadata[$key] ?? $default; } /** * Checkwhether have ResponseMessage.*/ public function hasResponseMessage(): bool { return ! empty($this->getResponseMessage()); } /** * Checkwhether is TextResponse.*/ public function isTextResponse(): bool { return $this->getResponseType() === 'text'; } /** * Checkwhether is ErrorResponse.*/ public function isErrorResponse(): bool { return $this->getResponseType() === 'error'; } /** * Convert toArray (containingAgentspecificfield).*/ public function toArray(): array { $baseArray = parent::toArray(); return array_merge($baseArray, [ 'agent_id' => $this->getAgentId(), 'session_id' => $this->getSessionId(), 'message_id' => $this->getMessageId(), 'response_message' => $this->getResponseMessage(), 'response_type' => $this->getResponseType(), 'response_metadata' => $this->getResponseMetadata(), ]); } /** * parseAgentspecificData.*/ private function parseAgentData(array $data): void { if (isset($data['agent_id'])) { $this->agentId = $data['agent_id']; } if (isset($data['session_id'])) { $this->sessionId = $data['session_id']; } if (isset($data['message_id'])) { $this->messageId = $data['message_id']; } if (isset($data['response'])) { $this->responseMessage = $data['response']; } if (isset($data['response_type'])) { $this->responseType = $data['response_type']; } if (isset($data['metadata']) && is_array($data['metadata'])) { $this->responseMetadata = $data['metadata']; } } } 